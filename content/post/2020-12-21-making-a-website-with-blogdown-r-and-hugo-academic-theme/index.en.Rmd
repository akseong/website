---
title: Making a Website with Blogdown, R, and Hugo Academic Theme
author: Arnie
date: '2020-12-28'
slug: make-website
categories:
  - guide
tags:
  - R
  - blogdown
  - HUGO
subtitle: 'join us on the glorious webtubeways of the blagoblag!'
summary: ''
authors: []
lastmod: '2020-12-21T19:36:17-08:00'
featured: no
image:
  caption: 'https://xkcd.com/181/'
  focal_point: ''
  preview_only: no
projects: []
---

```{r openingchunk, echo=FALSE, eval=TRUE}
knitr::opts_chunk$set(message=FALSE, 
                      eval=FALSE,
                      warning=FALSE,
                      echo=TRUE)

render_toc <- function(
  filename, 
  toc_header_name = "Table of Contents",
  base_level = NULL,
  toc_depth = 3
) {
  # credit Garrick Aden-Buie
  # https://www.garrickadenbuie.com/blog/add-a-generated-table-of-contents-anywhere-in-rmarkdown/
  # added ignore {-}
  x <- readLines(filename, warn = FALSE)
  x <- paste(x, collapse = "\n")
  x <- paste0("\n", x, "\n")
  for (i in 5:3) {
    regex_code_fence <- paste0("\n[`]{", i, "}.+?[`]{", i, "}\n")
    x <- gsub(regex_code_fence, "", x)
  }
  x <- strsplit(x, "\n")[[1]]
  x <- x[grepl("^#+", x)]
  x <- x[!grepl("^# \\{", x)]
  x <- x[!grepl("\\{-\\}", x)]  #ignore headings containing "{-}"
  if (!is.null(toc_header_name)) 
    x <- x[!grepl(paste0("^#+ ", toc_header_name), x)]
  if (is.null(base_level))
    base_level <- min(sapply(gsub("(#+).+", "\\1", x), nchar))
  start_at_base_level <- FALSE
  x <- sapply(x, function(h) {
    level <- nchar(gsub("(#+).+", "\\1", h)) - base_level
    if (level < 0) {
      stop("Cannot have negative header levels. Problematic header \"", h, '" ',
           "was considered level ", level, ". Please adjust `base_level`.")
    }
    if (level > toc_depth - 1) return("")
    if (!start_at_base_level && level == 0) start_at_base_level <<- TRUE
    if (!start_at_base_level) return("")
    if (grepl("\\{#.+\\}(\\s+)?$", h)) {
      # has special header slug
      header_text <- gsub("#+ (.+)\\s+?\\{.+$", "\\1", h)
      header_slug <- gsub(".+\\{\\s?#([-_.a-zA-Z]+).+", "\\1", h)
    } else {
      header_text <- gsub("#+\\s+?", "", h)
      header_text <- gsub("\\s+?\\{.+\\}\\s*$", "", header_text) # strip { .tabset ... }
      header_text <- gsub("^[^[:alpha:]]*\\s*", "", header_text) # remove up to first alpha char
      header_slug <- paste(strsplit(header_text, " ")[[1]], collapse="-")
      header_slug <- tolower(header_slug)
    }
    if (header_text != ""){
      paste0(strrep(" ", level * 4), "- [", header_text, "](#", header_slug, ")")
    }
  })
  x <- x[x != ""]
  knitr::asis_output(paste(x, collapse = "\n"))
}

# TEXT/TABLE FORMATTING----
colorhtml <- function(x, color="MediumOrchid") {
  sprintf("<span style='color: %s;'>%s</span>", color, x)
}
```



# Why use this guide? {-}
This is less a guide I wrote and more a mixture of guides/info from different sources (mostly by Alison Hill and Yihui Xie) annotated with my observations as a first-time user.  If you want a more streamlined guide, [Alison Hill's 2019 slides on starting a website with __blogdown__ and Hugo](https://arm.rbind.io/slides/blogdown.html){target="_blank"} are the bees' knees, though not specific to the Academic Theme.  

A few reasons you might want to use this guide anyways: it's the most recent as of this writing :sunglasses:, I'll detail some tricks / workarounds / failures, and I borrow `r colorhtml("heavily")` from Alison Hill's guide anyways.  

:::fyi
regarding recentness: it's actually a little important to follow a recent guide if you want to use Academic Theme for Hugo, as it underwent some changes in a major update earlier this year.  Following a guide written before then (not Alison Hill's, as I hadn't discovered hers at the time; hers also predates the update) caused me enough confusion/difficulties that I decided to start over once I figured a few things out.  
:::



## Who is this meant for? {-}
I decided to write this in large part to document what I did so that I can work on my website in the future, and __blogdown_ + Hugo can be [finicky as #$*!](https://yihui.org/en/2018/02/marie-dussault/#:~:text=BTW,amusing){target="_blank"} but hopefully this post can save you some pain and frustration if you are also a first-time user. 

So, essentially, this guide is meant for people like me a week ago: I use R, __rmarkdown__, and GitHub daily, but I had roughly, oh, about exactly zero experience with HTML, Hugo, or the __blogdown__ package.  

Also worth mentioning: I'm on a PC, so things might be a bit different for you Mac folks out there.



## Caveats {-}
I am not an expert on any of this!  I just started using this!  Some of the suggestions here may be sub-optimal, because basically if things worked I moved on.  Please feel free to let me know if you know of better ways to do any of this!






# Table of Contents:
```{r echo=FALSE, eval=TRUE}
render_toc(filename="index.en.Rmd", toc_depth = 2)
```



# Preliminaries:

## Note on changes to Academic Theme

As mentioned earlier, Academic Theme for Hugo had a big update earlier this year: it became part of something called Wowchemy, and this appears to have broken things for some people, or required different settings, probably because

  1. its folder structure changed, and 
  1. how it, um, handles some stuff is like, different.  (I really have no idea :shrug:)

A major thing that did not work for me was that __plots from .Rmd code chunks__ were not rendering. [Apparently __blogdown__ auto-detects and moves them](https://bookdown.org/yihui/blogdown/dep-path.html){target="_blank"} to the `static/` folder, so I suspect they weren't rendering because the folder structure changed.  Though it could just have been user error or some outdated settings.  Or the fact that my computer is mostly duct tape, [pasta](https://en.wikipedia.org/wiki/Alien_(film)#:~:text=pasta), and a hamster wheel.  




## Resources  

(ordered from most used to least used)

1. [slides by Alison Hill](https://arm.rbind.io/slides/blogdown.html){target="_blank"}
    - These are for a different theme, but her advice is accurate, practical, and clear.  Plus it's easy to follow steps in this presentation format.

1. [__blogdown__ documentation by Yihui Xie](https://bookdown.org/yihui/blogdown/hugo.html){target="_blank"}
    - Yihui Xie is basically the Gandalf of the Fellowship of R Users.  

1. [Wowchemy customization guide](https://wowchemy.com/docs/customization/){target="_blank"}
    - It was hard as a first-time user to find the info I needed here, but if/once I found it, it was helpful.

1. [post by Matteo Courthoud](https://matteocourthoud.github.io/post/website/){target="_blank"} on making a website
    - This is the guide I started off using first, leading to a rebuild.  As such, I don't recommend using this --- some of the specifics seem to be outdated.  __Follow Alison Hill's slides instead__.  I _did_, however, find it helpful to have already read Matteo's guide as I started my second attempt.  For example, the [section on Basic Customization](https://matteocourthoud.github.io/post/website/#:~:text=Basic%20Customization){target="_blank"} is helpful and specific.  Also, his color scheme is awesome and I totally copied it!





# Starting up:

* This section is almost all from [Alison Hill's slides](https://arm.rbind.io/slides/blogdown.html){target="_blank"}.


## Install latest __blogdown__ and Hugo:

```{r}
if (!requireNamespace("devtools")) install.packages('devtools')
devtools::install_github('rstudio/blogdown')
blogdown::install_hugo()
```


+ make a repo on GitHub.
+ create a new Rproject and connect it to the repo. 
  - in Rstudio: File --> New Project --> Version Control --> Git (if you don't know how to do these things, follow [the links in Alison's slides](https://arm.rbind.io/slides/blogdown.html#9){target="_blank"}.)



:::fyi
If you plan to host your website from GitHub, you will probably want to host it from a repository with the name `<yourGitHubusername>.github.io`.  So you can't use that for this step.
:::






## initialize site with Academic Theme

```{r}
library(blogdown)
new_site(theme="gcushen/hugo-academic",
         sample=TRUE,
         theme_example=TRUE,
         empty_dirs = TRUE,
         to_yaml = TRUE)
```

After that finishes, see if the site builds locally.  Use the "Addins" dropdown (end of the 2nd row of Rstudio's menu bar) to select "Serve site" or use

```{r}
blogdown::serve_site()
```


### .gitignore

Before we move on, add the `resources` and `public` folders to your `.gitignore` file so that it looks like this:
```{r}
.Rproj.user
.Rhistory
.RData
.Ruserdata
public/
resources/

```

:::fyi
If you haven't done this already, make sure your RStudio is configured to [make source files end with a newline](https://yihui.org/en/2018/04/rprofile-trailing-newline/){target="_blank"}.  

tl/dr; when you need it, not having it breaks things, and when you don't need it, having it doesn't harm anything.  It's kind of like [Pascal's Wager](https://en.wikipedia.org/wiki/Pascal%27s_wager){target="_blank"}, just a smidge less consequential.
:::




## check deployment 

Don't skip this step!  It will help you detect problems as you move forward.

Two common options for hosting:

+ __continuous deployment via Netlify (via GitHub)__: best if you want a different domain name, auto-deployment, or a web-form for messages.

+ __GitHub__: simpler on the face of it, but a few more steps required for deployment every time you update.





### option 1: continuous deployment via Netlify (recommended)

:::fyi
Alison Hill recommends [building the site locally, then dragging/dropping](https://arm.rbind.io/slides/blogdown.html#21){target="_blank"} the `public` folder into Netlify.  Apart from being an extra few steps --- [or just one step](https://matteocourthoud.github.io/post/website/#automation){target="_blank"} --- the main disadvantage is that this won't let you take advantage of __netlify's deploy branches__ option to test changes you make to the website before putting them out into the world.
:::



__Steps:__  

  1. Push everything to your GitHub repo.  __But don't use the RStudio built-in Git tab!__  Checking those boxes will take a loooong time if it completes at all. 

  <center>
  
  ![staging a large folder in RStudio's Git   tab](https://media.giphy.com/media/qNQFUVIKAt9Ek/giphy.gif){alt="also debugging a hugo website"}
  
  </center>

  + Instead, in the RStudio terminal (the tab next to your console), type:
  ```
  git add -A               # stages everything
  git commit -m "init"     # commit with message "init"
  git push  
  ```


  2. While you're waiting, set up an account at [netlify.com](netlify.com){target="_blank"}.
  1. Once you have an account and everything has been pushed, click "New site from Git" --> Github --> Only select repositories --> select your website repo.
      + If you end up switching repos for some reason, you can always [give Netlify access to another repo](https://docs.netlify.com/configure-builds/repo-permissions-linking/#troubleshoot-repository-linking){target="_blank"}.
  1. Your url will be something oddly delightful like "youthful-elephant-g0at33.netlify.app".  Change it: "Site settings" link --> "Change site name".  
      + You can always change the site name, or set up hosting on a new domain.  [`rbind.io` is a recommended, and free, option](https://support.rbind.io/about/){target="_blank"}.

Cool!  Now whenever you push to your repo, netlify will build it and serve your website.


:::note
Use the branch deploy feature to preview changes (such as a new post)!  All you have to do now is create a branch __AND make a pull request__, and netlify will let you preview it!  [More details + suggested workflow here](https://www.garrickadenbuie.com/blog/blogdown-netlify-new-post-workflow/){target="_blank"}.
:::




### option 2: Github deployment

__Steps:__  

1. Build the site: "Build" tab (next to Environment, History, Connections) --> Build Website
    + This builds your website locally, in a new folder named `public` in your project root directory.
1. Get the contents of the `public` folder (not the folder itself, just what's inside) into a GitHub repo named `<yourGitHubusername.github.io>`.  For example, my repo would be named `akseong.github.io`, and that would also be the url of my website.  

__Done!__  Super easy, but unfortunately, whenever you want to update your website or add content, you will need to follow these same steps.





# Folder structure: a short tour

Alison Hill gives you [a short assignment](https://arm.rbind.io/slides/blogdown.html#24){target="_blank"} to figure out your folder structure, and I think it's helpful to go through.  Your folders / files are going to look a little different, though (updates since 2019, different theme).

_Your_ folder structure will look like this (unless it's changed yet again!):

```{r}
├───archetypes
├───assets            # CSS, icons
├───config            
│   └───_default      # site customizations
├───content           
│   ├───authors       # modify about page info in the 'admin' folder
│   ├───courses
│   ├───home          # splash page
│   ├───post
│   ├───project
│   ├───publication
│   ├───slides
│   └───talk
├───data              
│   ├───fonts         
│   ├───themes        # "themes" = color scheme
├───layouts           # overrides theme layouts
├───R
├───resources         # intermediary build files - delete often
├───static            # place for files that do not need to get "built" by Hugo
│   ├───admin
│   └───media         # images used with posts/projects
└───themes            # NO TOUCH!  
```


The comments above should be fairly self-explanatory, but the `content` folder is worth discussing a little here.  The general idea is that the existing folders inside the `content` folder either  

1. are a separate page in the website
    - these folders contain an `index.md` file + widget `.md` files
1. or contain info used by widgets  
    - these folders usually contain a subfolder for each piece of content, e.g. each post or project

This is a little loose (e.g. the `contents/home/gallery` folder doesn't fit so neatly in here) but I find it useful to think of it this way.

## new page folders
The `home` folder is the only "separate page"-type folder here right now --- the Academic Theme by default generates a 1-page website --- but you can [add new folders for new website pages](#separate-pages){target="_blank"}.  Inside `content/home`, you'll see a file `index.md`; open it up.  It should say:

```
---
# Homepage
type: widget_page

# Homepage is headless, other widget pages are not.
headless: true
---
```

+ `type: widget page` indicates that the page initialized by this `index.md` file (the home page) is composed of $\geq 1$ widget.
+  the other `.md` files inside this folder (`content/home/`) are the different widgets on the home page, e.g. an "about" widget, an "accomplishments" widget, etc.


## widget info folders
Folders containing info used by widgets will have a file `_index.md` (note the underscore) and typically subfolders for entries.  For example, the folder `content/post/` is where your blog posts go by default, and each post gets its own subfolder inside `content/post`.  The widget that uses the content in `content/post/` is actually `contents/home/posts.md` --- a widget on the __home__ page --- which contains the lines 

``` 
widget: pages              # <-- widget type
...<other options>... 
page_type: post            # <-- where to find the content for the widget
```
These lines indicate that this is a `pages`-type widget, and that it draws its content from the folder `content/post/`.  Scroll down to the "Recent Posts" section on the homepage, and compare the posts to the folders inside `content/post/`.





# Basic customization

Now to make your website yours!  A few tips for troubleshooting while editing your website:

1. If not already running, use `blogdown::serve_site()` to see how your website responds to changes you make.  (You can also open the site in a browser tab using the "show in new window" icon in the viewer pane menu bar)
1. If changes you make do not seem to be appearing, stop and restart the local server by running `blogdown::stop_server()`, then `blogdown::serve_site()`.
1. If that doesn't work, try stopping the local server, deleting the `resources/` and `public/` folders in your project's root directory, and then starting the local server again.  

:::fyi
+ `resources/` contains intermediary build files, and will be auto-generated as needed.
+ `public/` is generated when you build the website using the "Build" tab.  If you opted for continuous deployment via Netlify, you don't need to build the website locally.
:::

4. Otherwise, take a look at [Alison Hill's troubleshooting guide](https://alison.rbind.io/post/2019-03-04-hugo-troubleshooting/){target="_blank"}, the [resources](#resources){target="_blank"} linked above, other peoples' website repos ([here's mine](https://github.com/akseong/website){target="_blank"}), or just Google it!




## Site config

There are 4 main files to edit:  

+ `config.yaml`: general site configuration (next section).
+ `config/_default/params.toml`: personal info + site feature configuration, e.g. syntax highlighting.  File is heavily commented, and does a fairly good job of explaining different options.
+ `config/_default/menus.toml`: navbar configuration.  Fairly straightforward (less straightforward if you want [separate pages instead of one long scrolling page](#separate-pages){target="_blank"}).

If in doubt about a particular setting in `params.toml` or `menus.toml`, leave it for now. However, `config.yaml` requires a bit more care.



### config.yaml
In `config.yaml` in your root directory, change the following fields:  

  + `title:` site name (your name if this is a personal website)
  + `baseurl:` set it to the url (in quotes) your site has been deployed to.  You didn't skip that step, did you?  If you did, you can also change it to '/'.  But it must be specified.  
      - include "https://" in the url.  Also, see [Yihui Xie's post on redirecting HTTP to HTTPS](https://yihui.org/en/2017/11/301-redirect/#an-application-redirect-http-links-to-to-https){target="_blank"}
  + `ignoreFiles:` Yihui Xie [recommends specifying these regex patterns](https://bookdown.org/yihui/blogdown/configuration.html#:~:text=at%20least%20these%20patterns){target="_blank"}.  If you've been following this guide so far, you have a `config.yaml` file instead of a `config.toml` file (as in the link).  The only things you should need to add to the default list under `ignoreFiles` are 
  
```{r}
    - \.knit\.md$
    - \.utf8\.md$
```


:::fyi
Some guides recommend including `"_files$"` in `ignoreFiles`, `r colorhtml("but this will break plots in .Rmd-generated posts")`.  

[Alison Hill's slides](https://arm.rbind.io/slides/blogdown.html#29){target="_blank"} recommend including it, so I'm assuming it's fine to include it if you're working with the Ada theme and/or deploying via drag/drop as her guide recommends --- in other words, if you're actually following her guide!
:::


Add the lines (I put these right beneath `baseurl:`):
```{r}
relativeURLs: yes
canonifyURLs: yes
```

+ `relativeURLs: yes` is necessary for cloud setup.  Also, if you don't specify your `baseurl`, some external links will break (spent an hour until I figured this out when trying to make a link to github in my nav bar --- worked in my local build, but not when deployed).

+ `cannonifyURLs: yes`: my understanding is that this makes it so that other people sharing your content via social media will link back to your actual website.

Last, beneath `permalinks`, I suggest adding `post: /:year-:month-:day/:slug/` (follow indents; modifies post urls, e.g. ".../2020-12-28/make-website/" rather than ".../post/make-website/").





## Your info

:::fyi
For ease of editing, bring the `about.md` widget to the top of the page by deactivating the `hero.md` and `demo.md` widgets in `content/home/` (set `active: false`), or make these widgets come after the `about.md` widget (set `weight:` > 20).  It will just be easier to see (using `blogdown::serve_site()`) the changes you're making.  You can always reactivate/reorder these widgets later.
:::

The `about.md` widget in `content/home/` uses info from the folder `content/authors/admin/`.  

+ For the text, edit `_index.md` with your info.  _Quick note:_ the `bio:` field in the header is what appears next to your name at the end of posts, not in the section generated by the "about" widget.
+ Add your picture by placing a .jpg image into `content/authors/admin/` and naming it `avatar.jpg`



## Other widgets

Poke around `content/home/` and modify the content of the different widgets with your info.

+ deactivate the widgets you don't want by setting `active: false`.  In general I would not delete these, as they are useful templates.
+ modify the order in which widgets appear using the `weight:` parameter (lower numbers = higher on page)







# Troubleshooting / adding desired functionality

## Modification to fix plotting

As mentioned waaaay earlier, plots generated by code chunks in .Rmd files were not showing up on my website.  This fixed it for me:  

1. create a setting in your `.Rprofile` to initialize new blog posts with a [page bundle](https://alison.rbind.io/post/2019-02-21-hugo-page-bundles/#hugo-page-bundles){target="_blank"}.

```{r}
library(usethis)
edit_r_profile()
options(blogdown.new_bundle = TRUE)
```

2. in `config.yaml` (root folder; these should already be OK if you've followed this guide)
  + `relativeURLs: yes`
  + `_files$` __`r colorhtml("MUST NOT BE")`__  under `ignoreFiles:`

My guess is that using page bundles and relative urls ensure that the built html page refers to the `*_files/` folder to source the images.  Again, this _was_ my first rodeo with blogdown and Hugo, so I do not know whether all of these steps are necessary --- I just know that plots weren't working before I changed these things, and then started showing up after I did these things.  It is entirely possible that only some of these things were necessary, but all of these things are recommended in the slides by Allison Hill anyways, _except_ for taking out `_files$` from `ignoreFiles:`.



## Add anchor link icons to post headings

+ [this worked for me](https://ericbryantphd.com/2020/01/13/add-section-links-in-blogdown/#my-solution){target="_blank"}

+ [this looks intriguing](https://github.com/rstudio/hugo-graphite/issues/38){target="_blank"}, but I couldn't figure out exactly what was happening.

+ [while writing this post, I found this solution by Gandalf, erm Yihui Xie](https://yihui.org/en/2018/11/md-js-tricks/#how-to-add-anchor-links-to-section-headings){target="_blank"}.  I just tried this, but there must be some steps left out that would be obvious to someone who uses javascript/blogdown/html/Hugo a lot, which is not me.


## ToC placement

Generating a table of contents using the built-in shortcodes or .Rmd header puts the table of contents first.  This is usually a good thing, except it can take up your entire post preview (i.e. the text you see below the post titles [here](/post_landing/){target="_blank"}.  

[Here's a workaround from Garrick Aden-Buie](https://www.garrickadenbuie.com/blog/add-a-generated-table-of-contents-anywhere-in-rmarkdown/){target="_blank"} so that you can place the table of contents anywhere you'd like.



## .Rprofile suggestions
https://arm.rbind.io/slides/blogdown.html#57
https://slides.yihui.org/2018-blogdown-rstudio-conf-Yihui-Xie.html#20














# Customization: advanced

## Themes / Fonts

## separate pages
`config/_default/menus.toml`
If you would like your website to be split across multiple separate pages (as opposed to one long scrolling page), 

- new pages instead of just one long scrolling page
index.md

```
widget: pages              # <-- widget type
...<other options>...
page_type: post            # <-- where to find the content for the widget
```

## widget backgrounds
look at widgets that have backgrounds already (e.g. `contents/home/demo.md`), copy stuff. 
+ static





https://github.com/rbind/apreshill/
https://github.com/rbind/yihui
https://github.com/rbind/nanhung

# general notes

- wowchemy file structure
- deleting examples
- .rmd support



