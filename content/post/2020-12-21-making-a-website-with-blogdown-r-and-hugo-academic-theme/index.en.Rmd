---
title: Making a Website with Blogdown, R, and Hugo Academic Theme
author: Arnie
date: '2020-12-21'
slug: making-a-website
categories:
  - guide
tags:
  - R
  - blogdown
  - HUGO
subtitle: 'join us on the glorious webtubeways of the blagoblag!'
summary: ''
authors: []
lastmod: '2020-12-21T19:36:17-08:00'
featured: no
image:
  caption: 'https://xkcd.com/181/'
  focal_point: ''
  preview_only: no
projects: []
---




# Why should you use this guide?

There are certainly better general purpose guides to __blogdown__ + Hugo out there ([these slides by Alison Hill in particular are great](https://arm.rbind.io/slides/blogdown.html)), but I could not find any __recent__ guides on setting up a website with __blogdown__ + the very popular Academic Theme for Hugo.  I followed an older guide --- several, actually --- and it was confusing, __because Academic Theme for Hugo changed__ when it moved to Wowchemy (whatever that is).  

A few things went wrong because of the combination of my inexperience and confusion over the change, and I ended up rebuilding everything :expressionless:.  So hopefully my experience as a first-time user of __blogdown__ and Academic Theme and Hugo can help save you some frustration.


## Who is this meant for?

Essentially, people like me a week ago: though I use R, __rmarkdown__, and GitHub daily, I had roughly, oh, about exactly zero experience with HTML, Hugo, or the __blogdown__ package. 

You might also find this helpful if you are troubleshooting your Academic Theme website after updating it recently.

Also worth mentioning: I'm on a PC, so things might be a bit different for you Mac folks out there.



## Caveats

I'm not an expert on any of this!  Some of my fixes might be sub-optimal, or perhaps even partially unnecessary.  If any of you out there read this and see things like this, please let me know!
 
Also, a lot of this is cobbled together from different sources, and I'll point you to them unless changes are necessary and would be easier to follow if I put it all in one place (I'm terribly lazy about duplicating work --- erm, I mean I want to make sure others get credit where due!  Both, really).




# Table of Contents:

```{r echo=FALSE}
render_toc <- function(
  filename, 
  toc_header_name = "Table of Contents",
  base_level = NULL,
  toc_depth = 3
) {
  # credit Garrick Aden-Buie
  # https://www.garrickadenbuie.com/blog/add-a-generated-table-of-contents-anywhere-in-rmarkdown/
  x <- readLines(filename, warn = FALSE)
  x <- paste(x, collapse = "\n")
  x <- paste0("\n", x, "\n")
  for (i in 5:3) {
    regex_code_fence <- paste0("\n[`]{", i, "}.+?[`]{", i, "}\n")
    x <- gsub(regex_code_fence, "", x)
  }
  x <- strsplit(x, "\n")[[1]]
  x <- x[grepl("^#+", x)]
  x <- x[!grepl("^# \\{", x)]
  if (!is.null(toc_header_name)) 
    x <- x[!grepl(paste0("^#+ ", toc_header_name), x)]
  if (is.null(base_level))
    base_level <- min(sapply(gsub("(#+).+", "\\1", x), nchar))
  start_at_base_level <- FALSE
  x <- sapply(x, function(h) {
    level <- nchar(gsub("(#+).+", "\\1", h)) - base_level
    if (level < 0) {
      stop("Cannot have negative header levels. Problematic header \"", h, '" ',
           "was considered level ", level, ". Please adjust `base_level`.")
    }
    if (level > toc_depth - 1) return("")
    if (!start_at_base_level && level == 0) start_at_base_level <<- TRUE
    if (!start_at_base_level) return("")
    if (grepl("\\{#.+\\}(\\s+)?$", h)) {
      # has special header slug
      header_text <- gsub("#+ (.+)\\s+?\\{.+$", "\\1", h)
      header_slug <- gsub(".+\\{\\s?#([-_.a-zA-Z]+).+", "\\1", h)
    } else {
      header_text <- gsub("#+\\s+?", "", h)
      header_text <- gsub("\\s+?\\{.+\\}\\s*$", "", header_text) # strip { .tabset ... }
      header_text <- gsub("^[^[:alpha:]]*\\s*", "", header_text) # remove up to first alpha char
      header_slug <- paste(strsplit(header_text, " ")[[1]], collapse="-")
      header_slug <- tolower(header_slug)
    }
    if (header_text != ""){
      paste0(strrep(" ", level * 4), "- [", header_text, "](#", header_slug, ")")
    }
  })
  x <- x[x != ""]
  knitr::asis_output(paste(x, collapse = "\n"))
}

render_toc(filename="index.en.Rmd")
# render_toc(filename)
```



# Preliminaries:

## Note on changes to Academic Theme

Academic Theme for Hugo semi-recently became part of something called Wowchemy, and this appears to have broken a few things for some people, probably because

  1. its folder structure changed, and 
  1. how it, um, handles some stuff is like, different.  (I really have no idea)

I suspect that these changes are what caused, for example, __plotting in code chunks not to work__ for me.  (Or user error.  Or the fact that my computer is mostly duct tape, [pasta](https://en.wikipedia.org/wiki/Alien_(film)#:~:text=pasta) and a hamster wheel.  But really I think it was the changes to Academic theme.)





## Resources  

(From most used to least used)

1. [slides by Alison Hill](https://arm.rbind.io/slides/blogdown.html)
    - These are for a different theme, but her advice is the best and most practical.  Plus it's easy to follow steps in this format.

1. [Wowchemy customization guide](https://wowchemy.com/docs/customization/)
    - It was hard as a first-time user to find the info I needed here, but if/once I did, it was helpful.
  
1. [__blogdown__ documentation by Yihui Xie](https://bookdown.org/yihui/blogdown/)
    - Yihui Xie is basically the Gandalf of the Fellowship of R Users.  

1. [post by Matteo Courthoud](https://matteocourthoud.github.io/post/website/) on making a website
    - __Follow Alison Hill's guide__, but this _is_ helpful as a quick overview.  It contains outdated information, unfortunately (this is the one I started off using, but then had to rebuild).  However, the [section on Basic Customization](https://matteocourthoud.github.io/post/website/#:~:text=Basic%20Customization) is helpful and specific, and his color scheme is awesome (I totally copied it!).





# Building your site:

This section is mostly from [Alison Hill's slides](https://arm.rbind.io/slides/blogdown.html).

## prep 

+ Install the latest versions of __blogdown__ and Hugo:

```{r eval=FALSE}
if (!requireNamespace("devtools")) install.packages('devtools')
devtools::install_github('rstudio/blogdown')
blogdown::install_hugo()
```


+ make a repo on GitHub
+ create a new Rproject (in Rstudio: File --> New Project --> )
  - if you don't know how to do this, check out [happygitwithr.com](https://happygitwithr.com/) first.



:::fyi
If you plan to host your website from GitHub, you'll want to create a 2nd repository with the name `<yourGitHubusername>.github.io`.  So you can't use that for this step.
:::




## create site with Academic Theme

```{r eval=FALSE}
library(blogdown)
new_site(theme="gcushen/hugo-academic",
         sample=TRUE,
         theme_example=TRUE,
         empty_dirs = TRUE,
         to_yaml = TRUE)
```

+ wait for it to finish, then try using `blogdown::serve_site()` to see what your new website looks like!
  - it's fairly unattractive as-is.  
  - it's also not your website ... yet!



## check deployment

:::fyi
Don't skip this step!  It will help you detect any problems with your setup so far.  I skipped it because I didn't see the point at the time... and ended up rebuilding everything due to a faulty initial download.
:::

Two common options:

- Netlify via GitHub: best if you want a different domain name, auto-deployment, or a web-form for messages.

- GitHub: simpler, but a few more steps required for deployment every time you update.


















### folder structure

Your folder structure will look like this (unless they change it yet again!):

```{r eval=FALSE}
├───archetypes
├───assets            # CSS, icons
├───config            # site configuration
│   └───_default
├───content           # play area
│   ├───authors       # your info in the 'admin' folder
│   ├───courses
│   ├───home
│   ├───post
│   ├───project
│   ├───publication
│   ├───slides
│   └───talk
├───data              # themes/fonts go here
├───layouts           # override .html files
├───R
├───resources         # intermediary build files
├───static            # images goes here
│   ├───admin
│   └───media
└───themes            # NO TOUCH!!
```







+ in your .gitignore file, add "public/" and "resources/".  It should look like this:

```{r eval=FALSE}
.Rproj.user
.Rhistory
.RData
.Ruserdata
public/
resources/
```






:::note
The "public" folder contains the actual website.  My understanding is that the "resources" folder contains intermediary files.  The other stuff
:::








# general notes

- wowchemy file structure
- deleting examples
- .rmd support









